<!DOCTYPE HTML>
<html lang="en"  xmlns:th="http://www.thymeleaf.org" 
>
<head th:include="console/header">
</head>
<body>

<section class="content-header">
    <h1>奖惩事件管理</h1>
    <div th:switch="${RY}">
    <small th:case="'RY'" style="font-size: 16px;">人员信息列表</small>
    <small th:case="'SJ'" style="font-size: 16px;">事件信息列表</small>
    </div>
</section>
<section class="content-header">
<fieldset> 	
<legend>查询条件</legend>
<div class="form-group">
<form id="searchbar" class="form-horizontal">
	<div class="form-group">
                    <label for="unitId" style="width:130px" class="col-xs-2 control-label">被考评科室</label>
                    <div class="col-xs-2">
                        <input type="text" class="form-control tonto-select-unit" name="orgUnitId" th:attr="unitid=${query?.orgUnitId}" placeholder="请选择科室"></input>
                    </div>
                    <label for="name" style="width:100px" class="col-xs-2 control-label">姓名</label>
                    <div class="col-xs-2">
                        <input type="text" name="name" th:value="${query?.name}" class="form-control" />
                    </div>
                    <label for="jobRank" style="width:80px" class="col-xs-2 control-label">职称</label>
                    <div class="col-xs-2">
                        <select name="jobRank" class="form-control tonto-select-constant" th:attr="selectedvalue=${query?.jobRank}" enumcode="job-rank-type">
                            <option value="">请选择</option>
                        </select>
                    </div>
                    
                    <label for="userProperty" style="width:90px" class="col-xs-2 control-label">人员属性</label>
                    <div class="col-xs-2">
                        <select name="userProperty" class="form-control tonto-select-constant" th:attr="selectedvalue=${query?.userProperty}" enumcode="user_property_type">
                            <option value="">请选择</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="isAssessor" style="width:130px" class="col-xs-2 control-label">是否考评人员</label>
                    <div class="col-xs-2">
                        <select name="isAssessor" class="form-control tonto-select-constant" th:attr="selectedvalue=${query?.isAssessor}" enumcode="boolean-type">
                            <option value="">请选择</option>
                        </select>
                    </div>
                    <label for="startRecordCreateTime" style="width:100px" class="col-xs-2 control-label">建档时间</label>
                    <div class="col-xs-2">
                        <input type="text" name="startRecordCreateTime" th:value="${query}?(${query.startRecordCreateTime}?${#dates.format(query.startRecordCreateTime,'yyyy-MM-dd')})"  class="form-control col-xs-2 tonto-datepicker-date" readonly="readonly" placeholder="请选择日期" />
                    </div>
                    <label for="endRecordCreateTime" style="width:80px;text-align:center" class="col-xs-1 control-label">至</label>
                    <div class="col-xs-2">
                        <input type="text" name="endRecordCreateTime" th:value="${query}?(${query.endRecordCreateTime}?${#dates.format(query.endRecordCreateTime,'yyyy-MM-dd')})" class="form-control col-xs-2 tonto-datepicker-date" readonly="readonly" placeholder="请选择日期" />
                    </div>
                    <div class="col-xs-2" style="text-align:right">
                        <a onclick="query()" class="btn btn-primary">查询</a>
                        <button type="reset" class="btn">重置</button>
                    </div>
                </div>
            </form>
            <input type="hidden" id="pageLimit" th:value="${query?.limit}" />
            <input type="hidden" id="pageOffset" th:value="${query?.offset}" />
 </div>
</fieldset>
</section>
<div id="toolbar">       
        <div class="btn-group">
		    <a id="viewPeacet" onclick="viewPeacet()" class="btn btn-default"><i class="glyphicon glyphicon-search"></i>查看</a>
		   	<a id="eventPeacet" onclick="eventPeacet()" class="btn btn-default"><i class="glyphicon glyphicon-cog"></i>奖惩事件维护</a>		    
		</div>
    </div>
<section class="content table-content">
    <table id="dataGrid"></table>
</section>
<!-- <div id="toolbar" th:switch="${RY}">
    <a th:case="'SJ'"  class="btn btn-success" ><i class="glyphicon glyphicon-plus"></i>添加奖惩事件</a>
</div> -->
<div  th:include="console/footer"></div>
<script type="text/javascript">
//<![CDATA[
		var table;
		$(function() {
		    $.getConstantEnum(["boolean-type", "sex-type", "job-duties-type", "job-rank-type", "oeducation-type"], initDataGrid);
		});
		
		  function initDataGrid(enumMap) {
			  	var limit = $("#pageLimit").val();
		        var offset = $("#pageOffset").val();
		        var page = (limit && offset) ? offset / limit + 1 : 1;
			  
		        table = $.createTable("#dataGrid", {
		            idField: "id",
		            columns: [
		                [
							{ radio:true },
		                    { title: "所在单位", field: "unitRootName"},
		                    { title: "被考评科室", field: "unitName" },
		                    { title: "是否考评人", field: "isAssessor", formatter: $.getEnumColumnFormatter(enumMap, "boolean-type") },
		                    { title: "姓名", field: "name" },
		                    { title: "性别", field: "sex", formatter: $.getEnumColumnFormatter(enumMap, "sex-type") },
		                    { title: "职称", field: "jobRank", formatter: $.getEnumColumnFormatter(enumMap, "job-rank-type") },
		                    { title: "职务", field: "jobDuties", formatter: $.getEnumColumnFormatter(enumMap, "job-duties-type") },
		                    { title: "学历", field: "oeducation", formatter: $.getEnumColumnFormatter(enumMap, "oeducation-type") },
		                    { title: "建档时间", field: "recordCreateTime",sortable: true}
		                ]
		            ],
		            url: '/org/user/search/all',
		            searchbar: '#searchbar',
		            sortName: 'recordCreateTime',
		            sortOrder: 'desc',
		            pageSize: limit || undefined,
		            pageNumber: page || 1,
		            pagination: true,
		            toolbar: "#toolbar",
		            showRefresh: true,
		            clickToSelect:true,
		            showColumns:true
		        });
		    }
		  
			
			function viewPeacet() {
				var row = getSelectRow();
				if(row){
					window.location.href="/console/peacet/index?type=ck&orgUserId="+row.id+"&stateUnit=0&isNull=1&isAgency=0";
				}else{
					$.errorMessage("请选中一条业务数据");
				}
			}
			//]]> 
		    
			//<![CDATA[
			function eventPeacet() {
				var row = getSelectRow();
				if(row){
					window.location.href="/console/peacet/index?type=sjwh&typeunit=unit&orgUserId="+row.id+"&stateUnit=0&isNull=1&isunit=1&isAgency=0";
				}else{
					$.errorMessage("请选中一条业务数据");
				}
			}
			//]]> 

		    function query() {
		        table.refresh();
		    }
		    
	    	function getSelectRow(){
	        	var rows = table.getSelections();
	    		return rows.length>0?rows[0]:null;
	        }
	    	
	    	// 关键词搜索框添加绑定回车函数
	        $('body').bind('keypress', function(event) {
	            if (event.keyCode == "13") {
	                query();
	            }
	        });
	    	
</script>

</body>
</html>