<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:include="console/header">
</head>

<body>
	<div class="container">
		<section class="content">
			<div class="box box-primary">
				<div class="box-header with-border">
					<div class="pull-right" th:if="${backurl} != null">
						<a th:href="${backurl}" class="btn btn-warning"><i
							class="glyphicon glyphicon-share-alt"></i>返回</a>
					</div>
					<div class="pull-right" style="margin-right: 10px">
						<a onclick="assessRegistration()" class="btn btn-default"><i
							class="glyphicon glyphicon-share-alt"></i>登记表</a>
					</div>
					<h4 class="box-title">医德医风档案信息</h4>
				</div>
				<div class="box-body" style="padding-bottom: 10px">
					<form class="form-horizontal" th:object="${user}">
						<div class="form-group">
							<label class="col-sm-2 control-label">所在单位：</label>
							<div class="col-sm-2">
								<p class="form-control-static" th:text="*{unitRootName}" />
							</div>
							<label class="col-sm-2 control-label">被考评科室：</label>
							<div class="col-sm-2">
								<p class="form-control-static" th:text="*{unitName}" />
							</div>
							<label class="col-sm-2 control-label">系统账号：</label>
							<div class="col-sm-2">
								<p class="form-control-static" th:text="*{account}" />
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-2 control-label">建档时间：</label>
							<div class="col-sm-2">
								<p class="form-control-static" th:text="*{recordCreateTime}" />
							</div>
							<label class="col-sm-2 control-label">姓名：</label>
							<div class="col-sm-2">
								<p class="form-control-static" th:text="*{name}" />
							</div>
							<label class="col-sm-2 control-label">性别：</label>
							<div class="col-sm-2">
								<p class="form-control-static" id="sex"
									th:attr="enum-code-value=${user.sex}" />
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-2 control-label">民族：</label>
							<div class="col-sm-2">
								<p class="form-control-static" id="nation"
									th:attr="enum-code-value=${user.nation}" />
							</div>
							<label class="col-sm-2 control-label">党派：</label>
							<div class="col-sm-2">
								<p class="form-control-static" id="partisan"
									th:attr="enum-code-value=${user.partisan}" />
							</div>
							<label class="col-sm-2 control-label">出生年月：</label>
							<div class="col-sm-2">
								<p class="form-control-static" th:text="*{birthday}" />
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-2 control-label">职称：</label>
							<div class="col-sm-2">
								<p class="form-control-static" id="jobRank"
									th:attr="enum-code-value=${user.jobRank}" />
							</div>
							<label class="col-sm-2 control-label">职务：</label>
							<div class="col-sm-2">
								<p class="form-control-static" id="jobDuties"
									th:attr="enum-code-value=${user.jobDuties}" />
							</div>
							<label class="col-sm-2 control-label">学历：</label>
							<div class="col-sm-2">
								<p class="form-control-static" id="oeducation"
									th:attr="enum-code-value=${user.oeducation}" />
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-2 control-label">参加工作时间：</label>
							<div class="col-sm-2">
								<p class="form-control-static" th:text="*{startWorkTime}" />
							</div>
							<label class="col-sm-2 control-label">进现单位工作时间：</label>
							<div class="col-sm-2">
								<p class="form-control-static" th:text="*{comeUnitTime}" />
							</div>
							<label class="col-sm-2 control-label">是否考评人员：</label>
							<div class="col-sm-2">
								<p class="form-control-static" id="isAssessor"
									th:attr="enum-code-value=${user.isAssessor}" />
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-2 control-label">考评科室：</label>
							<div class="col-sm-2">
								<p class="form-control-static" th:text="*{assessUnitName}" />
							</div>

							<label class="col-sm-2 control-label">人员属性：</label>
							<div class="col-sm-2">
								<p class="form-control-static" id="userProperty"
									th:attr="enum-code-value=${user.userProperty}" />
							</div>

							<label class="col-sm-2 control-label">职级：</label>
							<div class="col-sm-2">
								<p class="form-control-static" id="jobLevel"
									th:attr="enum-code-value=${user.jobLevel}" />
							</div>
						</div>


						<div class="form-group">
						
						    <label class="col-sm-2 control-label">证件类型：</label>
                            <div class="col-sm-2">
                                <p class="form-control-static"  id="certificateType"
                                    th:attr="enum-code-value=${user.certificateType}"/>
                            </div>
						
							<label class="col-sm-2 control-label">身份证号：</label>
							<div class="col-sm-2">
								<p class="form-control-static" th:text="*{identification}" />
							</div>
						</div>
					</form>
					<div style="padding: 20px">
						<ul id="myTab" class="nav nav-tabs">
							<li class="active"><a href="#tab1" data-toggle="tab">个人简历</a></li>
							<li><a href="#tab2" data-toggle="tab">考评情况</a></li>
							<li><a href="#tab3" data-toggle="tab">加·扣分记录</a></li>
						</ul>
						<div id="myTabContent" class="tab-content">
							<div class="tab-pane fade in active" id="tab1">
								<form class="form-horizontal" style="margin: 20px"
									th:object="${user}">
									<div class="form-group">
										<label for="resume" class="col-sm-2 control-label">个人简历</label>
										<div class="col-sm-8">
											<textarea class="form-control" rows="4" style="resize: none;"
												th:field="*{resume}" readonly="readonly"></textarea>
										</div>
									</div>
									<div class="form-group">
										<label for="reward" class="col-sm-2 control-label">历年奖励情况</label>
										<div class="col-sm-8">
											<textarea class="form-control" rows="4" style="resize: none;"
												th:field="*{reward}" readonly="readonly"></textarea>
										</div>
									</div>
									<div class="form-group">
										<label for="punish" class="col-sm-2 control-label">历年受惩情况</label>
										<div class="col-sm-8">
											<textarea class="form-control" rows="4" style="resize: none;"
												th:field="*{punish}" readonly="readonly"></textarea>
										</div>
									</div>
								</form>
							</div>
							<div class="tab-pane fade" id="tab2">
								<section class="content table-content">
									<table id="dataGrid1"></table>
								</section>
							</div>
							<div class="tab-pane fade" id="tab3">
								<section class="content-header">
									<div style="border: 1px #ddd solid; padding-top: 20px"
										class="box-body">
										<form id="searchbar" class="form-horizontal">
											<input type="hidden" th:value="${user.id}" name="userId" />
											<div class="form-group">
												<label style="width: 130px" for="cycleId"
													class="col-sm-2 control-label">考评周期</label>
												<div class="col-sm-3">
													<input type="text"
														class="form-control tonto-select-assess-cycle-user"
														required="required"
														th:attr="cycleid=${assessCycleId},cyclename=${assessCycleName},userid=${user.id}"
														name="cycleId" placeholder="请选择周期"></input>
												</div>

												<label for="eventType" style="width: 90px"
													class="col-sm-2 control-label">事件类型</label>
												<div class="col-sm-3">
													<select name="eventType" class="form-control">
														<option value="">请选择</option>
													</select>
												</div>

											</div>
											<div class="form-group">

												<label for="startHappenTime" style="width: 130px"
													class="col-sm-2 control-label">发生时间</label>
												<div class="col-sm-3">
													<input type="text" name="startHappenTime"
														class="form-control col-sm-2 tonto-datepicker-date"
														readonly="readonly" placeholder="请选择日期" />
												</div>
												<label for="endHappenTime"
													style="width: 90px; text-align: center"
													class="col-sm-2 control-label">至</label>
												<div class="col-sm-3">
													<input type="text" name="endHappenTime"
														class="form-control col-sm-2 tonto-datepicker-date"
														readonly="readonly" placeholder="请选择日期" />
												</div>
												<label for="name" style="width: 80px"
													class="col-sm-2 control-label"></label>
												<div class="col-sm-3" style="text-align: right">
													<a href="javascript:table2.refresh();"
														class="btn btn-primary">查询</a>
													<button type="button" class="btn tonto-reset-button">重置</button>
												</div>

											</div>
										</form>
									</div>
								</section>
								<section class="content table-content">
									<table id="dataGrid2"></table>
								</section>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div th:include="console/footer"></div>
		</section>
	</div>
	<script type="text/javascript">
    /*<![CDATA[*/
    var userId;
    $(function() {

        userId = $('[name="userId"]').val();

        var enums = [
            { code: "sex-type", type: 'p', target: '#sex' },
            { code: "nation-type", type: 'p', target: '#nation' },
            { code: "partisan-type", type: 'p', target: '#partisan' },
            { code: "job-rank-type", type: 'p', target: '#jobRank' },
            { code: "job-duties-type", type: 'p', target: '#jobDuties' },
            { code: "oeducation-type", type: 'p', target: '#oeducation' },
            { code: "boolean-type", type: 'p', target: '#isAssessor' },

            "ass-grades",
            "operateState",

            "examine",
            "operation",
            "event_type",
            { code: "event_type", type: 'select', target: '[name="eventType"]' },
            { code: "user_property_type", type: 'p', target: '#userProperty' },
            { code: "job_level", type: 'p', target: '#jobLevel' },
            { code: "certificate_type", type: 'p', target: '#certificateType' }
        ]

        $.getConstantEnum(enums, init);
    });

    function init(enumMap) {
        initTab2(enumMap);
        initTab3(enumMap);
    }

    var table1;

    function initTab2(enumMap) {
        table1 = $.createTable("#dataGrid1", {
            idField: "id",
            columns: [
                [
                    { title: "考评周期", field: "assessCycName" },
                    { title: "自评等级", field: "selfAssGrade", formatter: $.getEnumColumnFormatter(enumMap, "ass-grades") },
                    { title: "科室考评等级", field: "departGrade", formatter: $.getEnumColumnFormatter(enumMap, "ass-grades") },
                    { title: "医院考评等级", field: "unitAssGrade", formatter: $.getEnumColumnFormatter(enumMap, "ass-grades") },
                    { title: "操作状态", field: "operateState", formatter: $.getEnumColumnFormatter(enumMap, "operateState") },
                    {
                        title: "查看",
                        width: "60px",
                        align: 'center',
                        events: {
                            'click .view': function(e, value, row, index) {
                                viewAssess(row);
                            }
                        },
                        formatter: $.viewColumnFormatter()
                    }

                ]
            ],
            url: '/person/cyc/view/assess/situation?orgUserId=' + userId,
            pagination: true,
            showRefresh: true,
            showToggle: true
        });
    }

    function viewAssess(row) {
		layer.open({
            type: 2,
            title: ' ',
            maxmin: true, //开启最大化最小化按钮
            area: $.getOpenLayerSize(900, 700),
            content: '/person/cyc/detail?id=' + row.id
        });
    }


    var table2;

    function initTab3(enumMap) {
        table2 = $.createTable("#dataGrid2", {
            idField: "id",
            columns: [
                [
                    { title: "事件类型", field: "dictCode", formatter: $.getEnumColumnFormatter(enumMap, "event_type") },
                    { title: "发生时间", field: "happenTime" },
                    { title: "核定部门(人)", field: "checkPeople" },
                    { title: "操作状态", field: "operationState", formatter: $.getEnumColumnFormatter(enumMap, "operation") },
                    { title: "审核状态", field: "examineState", formatter: $.getEnumColumnFormatter(enumMap, "examine") },
                    { title: "审核人", field: "examinePeople" },
                    { title: "加分", field: "addScore" },
                    { title: "扣分", field: "reduceScore" },
                    { title: "一票否决", field: "isVeto", formatter: function(value, row, index) { return row.isVeto ? "有" : "无" } },
                    {
                        title: "查看",
                        width: "60px",
                        align: 'center',
                        events: {
                            'click .view': function(e, value, row, index) {
                                viewScore(row);
                            }
                        },
                        formatter: $.viewColumnFormatter()
                    }
                ]

            ],
            url: '/console/assess/quantitative/user/detail',
            searchbar: '#searchbar',
            pagination: false,
            showRefresh: true,
            showToggle: true
        });
    }


    function viewScore(row) {
        layer.open({
            type: 2,
            title: ' ',
            maxmin: true, //开启最大化最小化按钮
            area: $.getOpenLayerSize(800, 700),
            content: '/console/peacet/view?id=' + row.id
        });
    }

    
 // 关键词搜索框添加绑定回车函数
    $('body').bind('keypress', function(event) {
        if (event.keyCode == "13") {
        	table2.refresh();
        }
    });
 
    function assessRegistration() {
/*         layer.open({
            type : 2,
            title : '医德医风考评登记表',
            maxmin : true, //开启最大化最小化按钮
            area : $.getOpenLayerSize(900, 900),
            content : '/org/user/to/this/year/assess/page?orgUserId=' + userId
        }); */
		
        window.location = '/org/user/to/this/year/assess/page?orgUserId='+ userId
        
        
	}
 
    /*]]>*/
    </script>
</body>

</html>