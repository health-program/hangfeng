<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:include="/hf/header">
</head>

<body>
    <tt:constant enumcode="boolean-type,sex-type,job-duties-type,job-rank-type,oeducation-type"/>
    <section class="content-header">
        <h1>人员量化考评-机构</h1>
        <ol class="breadcrumb">
            <li class="active">列表</li>
        </ol>
    </section>
    <section class="content">
         <div class="box box-solid">
              <div class="box-header with-border">
                  <i class="fa fa-search"></i>
                  <h3 class="box-title">查询</h3>
              </div>
              <div class="box-body">
                  <form id="searchbar" class="form-horizontal">
		                <div class="form-group">
		                    <label for="unitId" style="width: 130px" class="col-sm-2 control-label">被考评科室</label>
		                    <div class="col-sm-2">
		                        <input type="text" class="form-control tonto-select-unit" name="unitId" th:attr="unitid=${query?.unitId}" placeholder="请选择科室"></input>
		                    </div>
		                    <label for="name" style="width: 130px" class="col-sm-2 control-label">姓名</label>
		                    <div class="col-sm-2">
		                        <input type="text" name="name" th:value="${query?.name}" class="form-control" />
		                    </div>
		                    <label for="jobRank" style="width: 80px" class="col-sm-2 control-label">职称</label>
		                    <div class="col-sm-2">
		                        <select name="jobRank" class="form-control tonto-select-constant" th:attr="selectedvalue=${query?.jobRank}" enumcode="job-rank-type">
		                            <option value="">请选择</option>
		                        </select>
		                    </div>
		                </div>
		                <div class="form-group">
		                    <label for="isAssessor" style="width: 130px" class="col-sm-2 control-label">是否考评人员</label>
		                    <div class="col-sm-2">
		                        <select name="isAssessor" class="form-control tonto-select-constant" th:attr="selectedvalue=${query?.isAssessor}" enumcode="boolean-type">
		                            <option value="">请选择</option>
		                        </select>
		                    </div>
		                    <label for="startRecordCreateTime" style="width: 130px" class="col-sm-2 control-label">建档时间</label>
		                    <div class="col-sm-2">
		                        <input type="text" name="startRecordCreateTime" th:value="${query}?(${query.startRecordCreateTime}?${#dates.format(query.startRecordCreateTime,'yyyy-MM-dd')})" class="form-control col-sm-2 tonto-datepicker-date" placeholder="请选择" />
		                    </div>
		                    <label for="endRecordCreateTime" style="width: 80px; text-align: center" class="col-sm-2 control-label">至</label>
		                    <div class="col-sm-2">
		                        <input type="text" name="endRecordCreateTime" th:value="${query}?(${query.endRecordCreateTime}?${#dates.format(query.endRecordCreateTime,'yyyy-MM-dd')})" class="form-control col-sm-2 tonto-datepicker-date" placeholder="请选择" />
		                    </div>
		                </div>
		                <div class="form-group">
		                    <label style="width: 130px" for="assessCycleId" class="col-sm-2 control-label">考评周期</label>
		                    <div class="col-sm-2">
		                        <input type="text" class="form-control tonto-select-assess-cycle-assess" required="required" th:attr="cycleid=${assessCycleId},cyclename=${assessCycleName}" name="assessCycleId" placeholder="请选择"></input>
		                    </div>
		                    <label style="width: 130px" for="isAssessed" class="col-sm-2 control-label">是否已考评</label>
		                    <div class="col-sm-2">
		                        <select name="isAssessed" class="col-sm-2 form-control tonto-select-constant" th:attr="selectedvalue=${query?.isAssessed}" enumcode="boolean-type">
		                            <option value="">请选择</option>
		                        </select>
		                    </div>
		                    <label for="name" style="width: 80px" class="col-sm-2 control-label"></label>
		                    <div class="col-md-12">
	                            <div class="pull-right">
	                               <button type="button" style="width:100px" class="btn btn-primary tonto-btn-search" onclick="table.refresh()"><i class="fa fa-search"></i>查询</button>
	                               <button type="button" style="width:100px" class="btn btn-default" onclick="$('form')[0].reset()"><i class="fa fa-repeat"></i>重置</button>
	                            </div>
                            </div>
		                </div>
                  </form>
                    <input type="hidden" id="pageLimit" th:value="${query?.limit}" />
                    <input type="hidden" id="pageOffset" th:value="${query?.offset}" />
              </div>
         </div>
         
         <div class="box box-solid" style="margin-top:20px">
            <div class="box-header with-border">
                <i class="fa fa-list-alt"></i>
                <h3 class="box-title">结果</h3>
            </div>
            <div id="result" class="box-body">
               <table id="dataGrid"></table>
            </div>
         </div>
    </section>
    
    
    <div th:include="/hf/footer"></div>
    <script type="text/javascript">
    /*<![CDATA[*/
    var table;
    
    $(function() {
        initDataGrid();
    });
    
    

    function initDataGrid() {
        var limit = $("#pageLimit").val();
        var offset = $("#pageOffset").val();
        var page = (limit && offset) ? offset / limit + 1 : 1;

        table = $.createTable("#dataGrid", {
            idField: "id",
            columns: [
                [
                    { title: "是否已考评", formatter: function(value, row, index) { return row.isAssessed && row.isAssessed == 1 ? "是" : "否" } },
                    { title: "所在单位", field: "unitRootName" },
                    { title: "被考评科室", field: "unitName" },
                    { title: "是否考评人", field: "isAssessor", enumcode:"boolean-type"},
                    { title: "姓名", field: "name" },
                    { title: "性别", field: "sex", enumcode:"sex-type"},
                    { title: "职称", field: "jobRank", enumcode:"job-rank-type"},
                    { title: "职务", field: "jobDuties", enumcode:"job-duties-type"},
                    { title: "学历", field: "oeducation", enumcode:"oeducation-type"},
                    { title: "建档时间", field: "recordCreateTime",formatter: "date"},
                    {
                        title: "操作",
                        align: "center",
                        width: "10%",
                        events: {
                            'click .assess': function(e, value, row, index){
                            	assess(row);
                            },
                            'click .view': function(e, value, row, index){
                            	view(row);
                            }
                        },
                        formatter: operateFormatter
                    }
                ]
            ],
            url: '/console/assess/quantitative/user',
            searchbar: '#searchbar',
            pagination: true,
            showRefresh: true,
            showToggle: true,
            clickToSelect: true,
            showColumns: true
        });
    }
    
    function operateFormatter(value,row,index) {
        return [
                '<button class="assess btn btn-xs btn-info" style="margin-right:10px">' ,
                '<i class="glyphicon glyphicon-cog"></i>量化考评' ,
                '</button>',
                '<button class="view btn btn-xs btn-success" style="margin-right:10px">' ,
                '<i class="glyphicon glyphicon-search"></i>查看',
                '</button>'
            ].join('');
    }

    function assess(row) {
        var cycleId = $('[name="assessCycleId"]').val();
        window.location = "/console/assess/quantitative/agency/user/index?userId=" + row.id + "&cycleId=" + cycleId;
    }

    function view(row) {
        var cycleId = $('[name="assessCycleId"]').val();
        window.location = "/console/assess/quantitative/agency/user/view?userId=" + row.id + "&cycleId=" + cycleId;
    }

    // 关键词搜索框添加绑定回车函数
    $('body').bind('keypress', function(event) {
        if (event.keyCode == "13") {
            table.refresh();
        }
    });


    /*]]>*/
    </script>
</body>

</html>