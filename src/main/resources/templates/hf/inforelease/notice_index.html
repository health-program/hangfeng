<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:include="console/header">
</head>
<body>

	<section class="content-header">
		<h1>通知公告管理</h1>
	</section>
	<section class="content-header">
		<fieldset>
			<legend>查询条件</legend>
			<form id="searchbar" class="form-horizontal">
				<div class="form-group">
					<input type="hidden" name="id" id="id" value="0" /> <label
						style="width: 110px" class="col-sm-2 control-label"
						for="isRelease">是否发布:</label>
					<div class="col-sm-2">
						<select id="isRelease" name="isRelease"
							class="form-control tonto-select-constant" enumcode="is_release">
							<option value="">请选择</option>
						</select>
					</div>
					<label style="width: 110px" class="col-sm-2 control-label"
						for="importance">重要程度:</label>
					<div class="col-sm-2">
						<select id="importance" name="importance"
							class="form-control tonto-select-constant" enumcode="importance">
							<option value="">请选择</option>
						</select>
					</div>
					<label style="width: 110px" class="col-sm-2 control-label"
						for="dict_id">标题:</label>
					<div class="col-sm-2">
						<input type="text" name="title" class="form-control" id="title" />
					</div>
				</div>
				<div class="form-group">
					<label style="width: 110px" class="col-sm-2 control-label"
						for="filingTime">发布时间:</label>
					<div class="col-sm-2">
						<input type="text" id="datepicker1" name="releaseTime"
							class="form-control tonto-datepicker-date" readonly="readonly"
							placeholder="请选择日期" />
					</div>
					<label style="width: 110px" class="col-sm-2 control-label"
						for="filingTime">至:</label>
					<div class="col-sm-2">
						<input type="text" id="datepicker2" name="endreleaseTime"
							class="form-control tonto-datepicker-date" readonly="readonly"
							placeholder="请选择日期" />
					</div>
					<div class="col-sm-6" style="text-align: right">
						<a onclick="query()" class="btn btn-primary">查询</a>
						<button type="reset" class="btn js-ajax-submit">重置</button>
					</div>
				</div>
			</form>
		</fieldset>

	</section>
	<div id="toolbar">
		<div class="btn-group">
			<a id="viewnotice" onclick="viewNotice()" class="btn btn-default"><i
				class="glyphicon glyphicon-search"></i>查看</a> <a id="addnotice"
				onclick="addnotice()" class="btn btn-default"><i
				class="glyphicon glyphicon-plus"></i>新增</a> <a id="editnotice"
				onclick="editNotice()" class="btn btn-default"><i
				class="glyphicon glyphicon-edit"></i>修改</a> <a id="removenotice"
				onclick="removeNotice()" class="btn btn-default"><i
				class="glyphicon glyphicon-remove"></i>删除</a>
		</div>
	</div>
	<section class="content table-content">
		<table id="dataGrid"></table>
	</section>

	<div id='info' style="display: none">
		<ul id="info2" class="list-group"></ul>
	</div>
	<div th:include="console/footer"></div>
	<script type="text/javascript">
		$table = $("#dataGrid");
		$(function () {
		    $.getConstantEnum(["is_release", "importance"], initDataGrid);
		  
		});
		function query(){
			$("#dataGrid").bootstrapTable('destroy');
			$.getConstantEnum(["is_release", "importance"], initDataGrid);
		}
		//查询单位信息
		function initDataGrid(enumMap){
		    $table.bootstrapTable({
		        height : tableModel.getHeight(),
		        idField : "id",
		        columns : [[
					{ radio:true },
		            {title: "标题", field: "title",width: "500px" },
		            {title: "是否发布", field: "isRelease",formatter: $.getEnumColumnFormatter(enumMap,"is_release") },
		            {title: "重要程度", field: "importance",formatter: $.getEnumColumnFormatter(enumMap,"importance") },
		            {title: "发布时间", field: "releaseTime",sortable: true ,width: "200px"}
		        ]],
		        url : '/console/infore/list/index',
		        queryParams: function(params){
		        	         var params = {
		        	        		 id:$("#id").val(),
		        	        		 title: $("#title").val(),
		        	        		 isRelease: $("#isRelease").val(),
		        	        		 importance: $("#importance").val(),
		        	        		 releaseTime: $("#datepicker1").val(),
		        	        		 endreleaseTime: $("#datepicker2").val(),
		        			sort:params.sort,
		        			order:params.order,
		        			limit: params.limit,
		        			offset:params.offset,
		        	    };       
		            return params;
		        },
		        responseHandler : function (res) {
		            return {
		                rows : res.result.pageInfo.list,
		                total : res.result.pageInfo.total
		            }
		        },
		        search : false,
		        sortName : 'create_time',
		        sortOrder : 'desc',
		        pagination : true,
		        sidePagination : 'server',
		        pageSize: 10,
		        pageList : [10,20,30],
		        toolbar : "#toolbar",
		        showRefresh : true,
		        clickToSelect:true,
		        showColumns:true
		    });
		}
		
		
		
	        function editNotice(id){
	        	var row = getSelectRow();
	        	if(row){
					layer.open({
						type : 2,
						title : ' ',
						maxmin : true, //开启最大化最小化按钮
			            area: $.getOpenLayerSize(800, 650),
						content : '/console/infore/edit/input?id=' + row.id,
						success : function(layero, index) {
							$.setLayerSubmitHandler(layero, index, function() {
								layer.close(index);
								$table.bootstrapTable('refresh', {url : '/console/infore/list/index'});
							}, "修改成功");
						}
					});
	        	}else{
	        		 $.errorMessage("请选中一条业务数据");
	        	}
				}
	    
	    function addnotice(){
		    	layer.open({
		               type: 2,
		               title: ' ',
		               maxmin: true, //开启最大化最小化按钮
			           area: $.getOpenLayerSize(800, 650),
		               content: '/console/infore/add/input',
		                success: function(layero, index){
		            	 $.setLayerSubmitHandler(layero,index, function(){
		            			layer.close(index);
		            			$table.bootstrapTable('refresh', {url: '/console/infore/list/index'});          		
		            	 },"保存成功");
		               } 
		           });
	    }
	        
	      function removeNotice() {
	    	  var row = getSelectRow();
	    	  if(row){
	    			layer.confirm('确定删除吗?', function() {
	    				$.getAjax('/console/infore/delete?id=' + row.id, function() {
	    					$.successMessage("删除成功");
	    					$table.bootstrapTable('refresh', {
	    						url : '/console/infore/list/index'
	    					});
	    				});
	    			});
	    	  }else{
	    		  $.errorMessage("请选中一条业务数据");
	    	  }
			
		}
	      
	      function viewNotice() {
	    	  var row = getSelectRow();
	    	  if(row){
	    		  layer.open({
						type : 2,
						title : ' ',
						maxmin : true, //开启最大化最小化按钮
			            area: $.getOpenLayerSize(800, 650),
						content : '/console/infore/view?id=' + row.id
					});
	    	  }else{
	    		  $.errorMessage("请选中一条业务数据");
	    	  }
			}
	      
	    	function getSelectRow(){
	        	var rows = $table.bootstrapTable('getSelections');
	    		return rows.length>0?rows[0]:null;
	        }
	    
	    	$('body').bind('keypress',function (event){
	            if(event.keyCode == '13'){
	                query();
	            }
	        });
	    	
</script>
</body>
</html>